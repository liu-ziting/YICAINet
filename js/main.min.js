var App={apiBasePath:"http://www.chenkaix.cn:8088/",rootPath:getRootPath(),filePath:'http://www.chenkaix.cn:8088/',timestamp:((Date.parse(new Date()))/1000).toString(),};function getQueryString(name){var reg=new RegExp('(^|&)'+name+'=([^&]*)(&|$)','i');var r=window.location.search.substr(1).match(reg);if(r!=null){return unescape(r[2])}return null};function imgError(image){$(image).attr("src",App.rootPath+"/img/kong.png")}function openUrl(url,type){if(!type){window.location.href=url}else{window.open(url)}};var http={ajax:function(options){var loading='';var def=$.Deferred();if(options.mask){loading=layer.msg('加载中，请稍后...',{icon:16,shade:0.01,time:0})}$.ajax({url:App.apiBasePath+options.url,data:options.data,type:options.type,xhrFields:{withCredentials:true},contentType:options.json?'application/json;charset=UTF-8':'application/x-www-form-urlencoded'}).then(function(rsp){def.resolve(rsp);setTimeout(function(){layer.close(loading)},100)},function(error){if(error.status==504){layer.msg('请求超时，请重试!',{icon:5})}else if(error.responseText){var err=JSON.parse(error.responseText);var code=err.code;var emsg=err.message;switch(code){case 500:layer.msg('服务器发生错误，请联系管理员！',{icon:5});break;case 403:break;case 401:layer.msg('登录失败！',{icon:5});break;case 10002:layer.msg('用户注册失败！',{icon:5});break;case 10000:layer.msg('手机号已存在！',{icon:5});break;case 10001:layer.msg('验证码发送失败！',{icon:5});break;case 10003:layer.msg('更改手机号失败',{icon:5});break;case 10004:layer.msg('更新失败',{icon:5});break}}def.reject(error);setTimeout(function(){layer.close(loading)},100)});return def}};function getNowFormatDate(){var date=new Date();var seperator1="-";var seperator2=":";var month=date.getMonth()+1;var strDate=date.getDate();if(month>=1&&month<=9){month="0"+month}if(strDate>=0&&strDate<=9){strDate="0"+strDate}var currentdate=date.getFullYear()+seperator1+month+seperator1+strDate+" "+date.getHours()+seperator2+date.getMinutes();return currentdate};function getRootPath(){var curWwwPath=window.document.location.href;var pathName=window.document.location.pathname;var pos=curWwwPath.indexOf(pathName);var localhostPaht=curWwwPath.substring(0,pos);var projectName=pathName.substring(0,pathName.substr(1).indexOf('/')+1);return(localhostPaht+projectName)};function addFavorite(){var url=window.location;var title=document.title;var ua=navigator.userAgent.toLowerCase();if(ua.indexOf("360se")>-1){layer.msg("由于360浏览器功能限制，请按 Ctrl+D 手动收藏！")}else if(ua.indexOf("msie 8")>-1){window.external.AddToFavoritesBar(url,title);}else if(document.all){try{window.external.addFavorite(url,title)}catch(e){layer.msg('您的浏览器不支持,请按 Ctrl+D 手动收藏!')}}else if(window.sidebar){window.sidebar.addPanel(title,url,"")}else{layer.msg('您的浏览器不支持,请按 Ctrl+D 手动收藏!')}};$("#footer").load("../page/footer.html");$(".searchBox .toptab span").click(function(){$(this).addClass("active").siblings().removeClass("active")});$(".searchBox .search span").click(function(){var key=$(".searchBox .search input").val();if(key){if($(".searchBox .toptab .active").index()==0){openUrl('drugList.html?key='+encodeURI(encodeURI(key))+'')}else{openUrl('materialsList.html?key='+encodeURI(encodeURI(key))+'')}}else{layer.msg('请先输入关键词！',{icon:5})}});function renderForm(){layui.use('form',function(){var form=layui.form;form.render()})};function beNull(data){for(let x in data){if(data[x]===null){data[x]='暂无'}else{if(typeof(data[x])==='object'){data[x]=beNull(data[x])}}}return data};function send_verify_code(phone,type){http.ajax({url:'user/send_verify_code',type:'POST',json:false,mask:true,data:{phone:phone,type:type}}).then(function(data){if(data.code==200){layer.msg('验证码发送成功！')}},function(err){console.log(err)})};get_user_info();function get_user_info(){http.ajax({url:'user/get_user_info',type:'GET',json:false,mask:false}).then(function(data){if(data.code==200){$(".topLoginBox").show().find("a").hide();$(".userTop").show().css("margin-left","0");localStorage.setItem("phone",data.data.phone)}},function(err){if(err.status){$(".topLoginBox").show().find("a").show();$(".userTop").hide()}})};document.onreadystatechange=function(){if(document.readyState=="complete"){update_token();}};function update_token(){http.ajax({url:'user/update_token',type:'GET',json:false,mask:false}).then(function(data){if(data.code==200){}},function(err){if(err.status==403){$(".topLoginBox").show().find("a").show();$(".userTop").hide()}})};function countDownCode(){var num=60;var timer=setInterval(function(){if(num>1){num-=1;$(".getCode").text("重新发送("+num+")").attr("disabled","disabled");$(".getCode").css('background','#B8B8B8')}else{$(".getCode").text("获取短信验证码").removeAttr("disabled");$(".getCode").css('background','#195edd');clearInterval(timer)}},1000)}function download(id){http.ajax({url:'resource/download',type:'GET',json:false,mask:true,data:{id:id}}).then(function(data){if(data.code==200){}},function(err){if(err.status==403){layer.msg('请先登录！',{icon:5},function(){location.href='login.html'})}else if(err.status==10007){location.href='buyBook.html?id='+id+'&operationType=download'}})};function logout(){http.ajax({url:'user/logout',type:'GET',json:false,mask:true}).then(function(data){if(data.code==200){layer.msg('退出成功！');location.href='login.html'}},function(err){})};friendLinkList();function friendLinkList(){http.ajax({url:'friend_link/list',type:'GET',json:false,mask:false,data:{pageNo:'1',pageSize:'7'}}).then(function(data){if(data.code==200){var innerHTML="";for(var i=0;i<data.data.items.length;i+=1){innerHTML+='<a target="_blank" href="'+data.data.items[i].url+'">'+data.data.items[i].webName+'</a>'};$("#linkList").append(innerHTML)}},function(err){})};function rchasingActivities(){http.ajax({url:'news/get_news_list_by_type_id',type:'GET',json:false,mask:false,data:{typeId:20,pageNo:1,pageSize:10,purchaseStatus:"",openTime:"",endTime:"",searchkey:""}}).then(function(data){if(data.code==200){var innerHTML="";for(var i=0;i<data.data.items.length;i+=1){innerHTML+='<li id="'+data.data.items[i].id+'"><span>'+(i+1)+'</span><p>'+data.data.items[i].title+'</p></li>'};$("#rchasingActivitiesList").append(innerHTML);$("#rchasingActivitiesList li").click(function(){var purchaseId=$(this).attr("id");openUrl('purchase.html?purchaseId='+purchaseId+'')})}},function(err){})};function biddingAcAtivities(){http.ajax({url:'news/get_news_list_by_type_id',type:'GET',json:false,mask:false,data:{typeId:7,pageNo:1,pageSize:10,purchaseStatus:"",openTime:"",endTime:"",searchkey:""}}).then(function(data){if(data.code==200){var innerHTML="";for(var i=0;i<data.data.items.length;i+=1){innerHTML+='<li id="'+data.data.items[i].id+'"><span>'+(i+1)+'</span><p>'+data.data.items[i].title+'</p></li>'};$("#rchasingActivitiesList").append(innerHTML);$("#rchasingActivitiesList li").click(function(){var purchaseId=$(this).attr("id");openUrl('callForBids.html?purchaseId='+purchaseId+'')})}},function(err){})};