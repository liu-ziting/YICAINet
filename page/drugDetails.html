<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>医采网-药品信息</title>
	<link rel="stylesheet" href="../layui/css/layui.css" />
	<link rel="stylesheet" href="../css/index.css" />
</head>

<body>
	<!--头部-->
	<header>
		<div class="htop">
			<div class="centered">
				<div class="left">
					<p>欢迎来到医采网！</p>
					<img class="loginIcon" src="../img/user.png" />
					<span class="topLoginBox">
						<a class="login" href="login.html">登录 &nbsp;&nbsp;|</a>
						<a class="register" href="register.html">免费注册</a>
						<a class="userTop" href="user.html">个人中心</a>
					</span>
				</div>
				<div class="right">
					<img src="../img/iPhone.png" />
					<p>免费咨询热线：0550-3022569</p>
					<span>|</span>
					<p onclick="addFavorite()">收藏 </p>
					<span>|</span>
					<p>帮助</p>
				</div>
			</div>
		</div>
		<div class="searchBox">
			<div class="centered">
				<a class="logo" href="../index.html">
					<img src="../img/logo.png" />
				</a>
				<!--搜索-->
				<div class="rightBox">
					<div class="toptab">
						<span class="active">查询药品</span>
						<span>查询耗材</span>
					</div>
					<div class="search">
						<input type="text" name="title" required lay-verify="required" placeholder="请输入搜索关键词"
							autocomplete="off" class="layui-input">
						<span>
							<img src="../img/ss.png" />
						</span>
					</div>
				</div>
			</div>
		</div>
		<!--导航-->
		<nav>
			<div class="centered">
				<ul>
					<li onclick="openUrl('../index.html')">首页</li>
					<li onclick="openUrl('callForBids.html')">招标采购信息</li>
					<li class="active" onclick="openUrl('drugList.html')">药品信息</li>
					<li onclick="openUrl('materialsList.html')">耗材信息</li>
					<li onclick="openUrl('facilityList.html')">设备信息</li>
					<li onclick="openUrl('policy.html')">政策法规</li>
					<li onclick="openUrl('download.html')">下载中心</li>
				</ul>
			</div>
		</nav>
	</header>
	<div id="viewDetails"></div>
	<script id="drugDetailsTpl" type="text/html">
	<div class="drugDetails centered">
		<div class="topDetail">
			<div class="left">
				<div class="wrap">
					<div class="biger" id="biger"></div>
					<div class="imgs">
						<div class="main" id="main">
							<div class="mask" id="mask"></div>
						</div>
						<p>*图片仅供参考，以实际标准为准</p>
						<ul class="smaller" id="smaller"></ul>
					</div>
				</div>
			</div>
			
			<div class="right">
					<h1>{{d.commonName}}</h1>
					<p>药品代码：{{d.drugCode}}</p>
					<p>批准文号：{{d.approvalNumber}}</p>
					<p>商品名称：{{d.productName}}</p>
					<p>剂型：{{d.dosageForm}}</p>
					<p>规格/型号：{{d.specification}}</p>
					<p>包装：{{d.largePackage}}</p>
					<p>最小使用单位：{{d.minimumUseUnit}}</p>
					<p>生产厂家：{{JSON.parse(d.manufacturer).name}}</p>
					<hr />
					<p>市场售价：<span>￥{{d.marketPrice}}</span><a href="login.html">登录可见</a></p>

					{{#  if( d.otherPrice == '暂无'){ }}
					{{#  } else { }}
					{{#  for (var i = 0; i < JSON.parse(d.otherPrice).length; i++) { }}
					<p>名称：{{JSON.parse(d.otherPrice)[i].name}}，地址：{{JSON.parse(d.otherPrice)[i].address}}，价格：{{JSON.parse(d.otherPrice)[i].price}}</p>
					{{#  } }}  
					{{#  } }} 
				
					<button onclick="openUrl('login.html')" type="button" class="layui-btn">
					<i class="layui-icon">&#xe66f;</i> 马上登录
					</button>
				
			</div>
		</div>
		<div class="drugMain">
			<h1>药品<b>信息</b></h1>
			<button onclick="openUrl('login.html')" type="button" class="layui-btn">
				登录查看完整信息<i class="layui-icon">&#xe62f;</i>
			</button>
			<section>
				<div class="masking"></div>
				<ul>
					<li>
						<p>通用名/化学名：</p>
						<span>{{d.commonName}}</span>
					</li>
					<li>
						<p>医保支付价格：</p>
						<span>{{d.healthInsurancePrice}}</span>
					</li>
					<li>
						<p>生产厂家：</p>
						<span>{{JSON.parse(d.manufacturer).name}}</span>
					</li>
					<li>
						<p>生产地址：</p>
						<span>{{JSON.parse(d.manufacturer).address}}</span>
					</li>
					<li>
						<p>联系电话：</p>
						<span>{{JSON.parse(d.manufacturer).tel}}</span>
					</li>
					<li>
						<p>批准文号：</p>
						<span>{{d.approvalNumber}}</span>
					</li>
					<li>
						<p>规格/型号：</p>
						<span>{{d.specification}}</span>
					</li>
					<li>
						<p>包装：</p>
						<span>{{d.largePackage}}</span>
					</li>
					<li>
						<p>剂型：</p>
						<span>{{d.dosageForm}}</span>
					</li>
				</ul>
				<h2>使用说明书</h2>
				<p class="instructions">{{d.instructions}}</p>
			</section>
		</div>
	</div>
	</script>

	<div id="footer"></div>
	<script type="text/javascript" src="../js/jquery-3.4.1.min.js"></script>
	<script type="text/javascript" src="../layui/layui.all.js"></script>
	<script type="text/javascript" src="../js/main.js"></script>
	<script>
		layui.use(['laytpl', 'layer'], function () {
			var laytpl = layui.laytpl;
			//获取药品详情
			http.ajax({
				url: 'product/drug_detail',
				type: 'GET',
				json: false,
				mask: true,
				data: {
					id: getQueryString("id")
				}
			}).then(function (data) {
				var result = data;
				if (data.code == 200) {
					var data = beNull(data.data);
					var getTpl = drugDetailsTpl.innerHTML
						, view = document.getElementById('viewDetails');
					laytpl(getTpl).render(data, function (html) {
						console.log(data)
						view.innerHTML = html;
						if (result.login) {
							$("#viewDetails a").hide();
							$("button").hide();
							$(".masking").hide();
							$(".drugDetails .drugMain li").css("filter", "inherit");
							$(".drugDetails .drugMain h2").css("filter", "inherit");
							$(".drugDetails .instructions").css("filter", "inherit");
						} else {
							$("#viewDetails span").hide();
						};

						// 图片列表
						var imgArr = []
						if(result.login == true){
							if(result.data.images == '暂无' || result.data.images == null || result.data.images == undefined){
								imgArr = [App.filePath+result.data.image.newFilename]
							}else{
								for (var i = 0; i < result.data.images.length; i++) {
									imgArr.push(App.filePath+result.data.images[i].newFilename)
								}
							}
							
						}else{
							imgArr = [App.filePath+result.data.image.newFilename,'../img/moreimg.png']
						}
						imgList(imgArr);
					});
				}
			}, function (err) {
				console.log(err)
				if (err.status == 403) {
					layer.msg('登录已失效！', {
						icon: 5
					}, function () {
						location.href = 'login.html';
					});
				}
			});

		});


		function imgList(imgArr) {
			var biger = document.getElementById('biger');
			var main = document.getElementById('main');
			var smaller = document.getElementById('smaller');
			var mask = document.getElementById('mask');
			var wrap = biger.parentNode;
			var imgArr = imgArr;
			var imgSum = imgArr.length;
			if (imgSum > 5) {
				imgSum = 5;
			}
			for (var i = 0; i < imgSum; i++) {
				var lis = document.createElement('li');
				var imgs = document.createElement('img');
				imgs.src =imgArr[i]
				lis.appendChild(imgs);
				smaller.appendChild(lis);
			}
			var mainImg = document.createElement('img');
			var bigImg = document.createElement('img');
			var liArr = smaller.children;
			bigImg.src = mainImg.src = liArr[0].children[0].src;
			main.insertBefore(mainImg, mask);
			biger.appendChild(bigImg);
			var bigPic = biger.children[0];
			liArr[0].className = 'current';
			for (var i = 0; i < liArr.length; i++) {
				liArr[i].index = i;
				liArr[i].onclick = function () {
					this.className = 'current';
					bigPic.src = main.children[0].src = this.children[0].src;
					for (var j = 0; j < liArr.length; j++) {
						if (this != liArr[j]) {
							liArr[j].removeAttribute('class');
							liArr[j].removeAttribute('className');
						}
					}
				}
			}
			$("#main img").attr("onerror","imgError(this)");
			$("#smaller img").attr("onerror","imgError(this)")
			main.onmouseenter = function () {
				mask.style.display = 'block';
				biger.style.display = 'block';
			}
			main.onmouseleave = function () {
				mask.style.display = 'none';
				biger.style.display = 'none';
			}
			main.onmousemove = function (e) {
				var e = e || window.event;
				var pagex = e.pageX || scroll().left + e.clientX;
				var pagey = e.pageY || scroll().top + e.clientY;
				pagex = pagex - wrap.offsetLeft - mask.offsetWidth / 2;;
				pagey = pagey - wrap.offsetTop - mask.offsetHeight / 2;
				if (pagex < 0) {
					pagex = 0;
				}
				if (pagey < 0) {
					pagey = 0;
				}
				if (pagex > main.offsetWidth - mask.offsetWidth) {
					pagex = main.offsetWidth - mask.offsetWidth;
				}
				if (pagey > main.offsetHeight - mask.offsetHeight) {
					pagey = main.offsetHeight - mask.offsetHeight;
				}
				mask.style.left = pagex + 'px';
				mask.style.top = pagey + 'px';
				var scale = (bigPic.offsetWidth - biger.offsetWidth) / (main.offsetWidth - mask.offsetWidth);
				var xx = pagex * scale;
				var yy = pagey * scale;
				bigPic.style.left = -xx + 'px';
				bigPic.style.top = -yy + 'px';
			};

			
		}
		
	</script>
</body>

</html>