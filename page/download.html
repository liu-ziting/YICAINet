<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>医采网-下载中心</title>
	<link rel="stylesheet" href="../layui/css/layui.css" />
	<link rel="stylesheet" href="../css/index.css" />
	<style>
		.application {
			padding: 15px 10px;
			display: none;
		}

		.application p {
			margin: 10px 0;
			overflow: hidden;
		}

		.application p span {
			display: block;
			float: left;
			width: 50%;
		}

		.application .layui-upload {
			float: left;
			width: 100%;
		}

		.application button {
			width: 100%;
		}

		.application .submit {
			width: 80%;
			margin-left: 10%;
			height: 45px;
			margin-top: 20px;
			margin-bottom: 30px;
		}

		.application label {
			margin-bottom: 10px;
			overflow: hidden;
			display: block;
			float: left;
			width: 46%;
			margin: 0 2%;
		}

		.application label img {
			width: 100%;
			height: 100px;
		}

		.layui-upload-list {
			width: 100%;
		}
	</style>
</head>

<body>
	<!--头部-->
	<header>
		<div class="htop">
			<div class="centered">
				<div class="left">
					<p>欢迎来到医采网！</p>
					<img class="loginIcon" src="../img/user.png" />
					<span class="topLoginBox">
						<a class="login" href="login.html">登录 &nbsp;&nbsp;|</a>
						<a class="register" href="register.html">免费注册</a>
						<a class="userTop" href="user.html">个人中心</a>
						<span onclick="openUrl('inform.html')" class="unreadSizeTop"></span>
					</span>
				</div>
				<div class="right">
					<img src="../img/iPhone.png" />
					<p>免费咨询热线：0551-65311145</p>
					<span>|</span>
					<p onclick="addFavorite()">收藏 </p>
					<span>|</span>
					<p>帮助</p>
				</div>
			</div>
		</div>
		<div class="searchBox">
			<div class="centered">
				<a class="logo" href="../index.html">
					<img src="../img/logo.png" />
				</a>
				<!--搜索-->
				<div class="rightBox">
					<div class="toptab">
						<span class="active">查询药品</span>
						<span>查询耗材</span>
						<span>查询设备</span>
					</div>
					<div class="search">
						<input type="text" name="title" required lay-verify="required" placeholder="请输入搜索关键词"
							autocomplete="off" class="layui-input">
						<span>
							<img src="../img/ss.png" />
						</span>
					</div>
				</div>
			</div>
		</div>
		<!--导航-->
		<nav>
			<div class="centered">
				<ul>
					<li onclick="openUrl('../index.html')">首页</li>
					<li>
						<p onclick="openUrl('callForBids.html')">招标采购信息</p>
						<section class="dropDownNav">
							<div onclick="openUrl('callForBids.html?urltypeId=7')">招标采购公告</div>
							<div onclick="openUrl('callForBids.html?urltypeId=9')">变更答疑</div>
							<div onclick="openUrl('callForBids.html?urltypeId=23')">中标成交公告</div>
							<div onclick="openUrl('callForBids.html?urltypeId=24')">项目异常公告</div>
						</section>
					</li>
					<li onclick="openUrl('drugList.html')">药品信息</li>
					<li onclick="openUrl('materialsList.html')">耗材信息</li>
					<li onclick="openUrl('facilityList.html')">设备信息</li>
					<li>
						<p onclick="openUrl('policy.html')">政策法规</p>
						<section class="dropDownNav">
							<div onclick="openUrl('policy.html?urltypeId=10')">国家政策法规</div>
							<div onclick="openUrl('policy.html?urltypeId=11')">安徽政策法规</div>
						</section>
					</li>
					<li class="active">
						<p onclick="openUrl('download.html')">下载中心</p>
						<section class="dropDownNav">
							<div onclick="openUrl('download.html?urltypeId=12')">药品招标相关文件</div>
							<div onclick="openUrl('download.html?urltypeId=13')">耗材招标相关文件</div>	
							<div onclick="openUrl('download.html?urltypeId=14')">政府采购相关文件</div>	
							<div onclick="openUrl('download.html?urltypeId=15')">设备招标相关文件</div>
							<div onclick="openUrl('download.html?urltypeId=16')">工程招标相关文件</div>	
							<div onclick="openUrl('download.html?urltypeId=17')">服务招标相关文件</div>	
							<div onclick="openUrl('download.html?urltypeId=18')">咨询服务相关文件</div>
							<div onclick="openUrl('download.html?urltypeId=19')">其他文件资料下载</div>
						</section>
					</li>
					<li onclick="openUrl('contactUs.html')">联系我们</li>
				</ul>
			</div>
		</nav>
	</header>
	<div class="download centered">
		<div class="left">
			<h1>下载中心</h1>
			<div id="viewLeft"></div>
			<script id="downloadLeftTpl" type="text/html">
					<ul class="leftTab">
						{{# layui.each(d.items, function(index, item){ }}
						<li>
							<input type="hidden" class="id" value="{{item.id}}" />
							<p>{{item.name}}<span>>></span></p>
						</li>
						{{# }); }}
					</ul>
				</script>
			<!--广告位-->
			<div class="advertising">
				<div class="layui-carousel" id="advertisingList" lay-filter="advertisingList">
					<div carousel-item="" id="advertisingListBox">
						<!-- <div>
							<a href="#">
								<img src="../img/gg.png" />
							</a>
						</div> -->
					</div>
				</div>
			</div>
			<!--采购活动-->
			<div class="cgactivity">
				<h1 class="title">采购<b>活动</b></h1>
				<ul id="rchasingActivitiesList">
					<!-- <li>
						<span>01</span>
						<p>滁州一男子居然做出这种事情</p>
					</li> -->
				</ul>
			</div>
		</div>
		<div class="right">
			<h1>
				<b>药品招标相关文件</b>
				<p>当前位置：<a href="download.html">下载中心</a> >> <a class="crumbs" href="#">药品招标相关文件</a></p>
			</h1>
			<div class="rightList">
				<ul>
					<div id="viewRight"></div>
					<script id="downloadRightTpl" type="text/html">
						{{# layui.each(d.items, function(index, item){ }}
						<li>
							<h2>{{item.title}}<span class="dlBox">下载<input type="hidden" class="id" value="{{item.id}}" /></span></h2>
							<time>{{item.createDate}}
							<a href="javascript:;" >
								<img onclick="weixin(this)" id="/mobile/page/buyBook.html?id={{item.id}}&operationType=download" src="../img/c19-05.png"/>
								<img onclick="shareToXl(this)"  id="/mobile/page/buyBook.html?id={{item.id}}&operationType=download" bt="{{item.title}}" src="../img/c19-06.png"/>
								<img onclick="shareToQq(this)" id="/mobile/page/buyBook.html?id={{item.id}}&operationType=download" bt="{{item.title}}" src="../img/c19-07.png"/>
							</a>
							</time>
						</li>
						{{# }); }} {{# if(d.items.length === 0){ }}
						<li>
							<h2>暂无相关文件 </h2>
						</li>
						{{# } }}
						</script>
				</ul>
				<!--分页-->
				<div id="paging" class="paging"></div>
			</div>
		</div>
	</div>
	<div class="application">
		<form class="layui-form">
			<label>
				<p>授权人</p>
				<input type="text" name="authorizer" lay-verify="required" lay-reqtext="请输入授权人" placeholder="请输入授权人"
					autocomplete="off" class="layui-input">
			</label>
			<label>
				<p>公司名称</p>
				<input type="text" name="companyName" lay-verify="required" lay-reqtext="请输入您的公司名称"
					placeholder="请输入您的公司名称" autocomplete="off" class="layui-input">
			</label>
			<label>
				<p>手机号</p>
				<input type="text" name="phone" lay-verify="required" lay-reqtext="请输入您的手机号码" placeholder="请输入您的手机号码"
					autocomplete="off" class="layui-input">
			</label>
			<label>
				<p>邮箱</p>
				<input type="text" name="email" lay-verify="required" lay-reqtext="请输入您的邮箱" placeholder="请输入您的邮箱"
					autocomplete="off" class="layui-input">
			</label>
			<label>
				<p><span>营业执照图片</p>
				<div class="layui-upload">
					<button type="button" class="layui-btn layui-btn-primary" id="test1"><i
							class="layui-icon"></i>上传营业执照图片</button>
					<div class="layui-upload-list">
						<img class="layui-upload-img" id="demo1">
						<input type="hidden" name="businessLicense" id="businessLicense" value="" lay-verify="required"
							lay-reqtext="请上传营业执照图片" />
						<p id="demoText1"></p>
					</div>
				</div>

			</label>
			<label>
				<p>授权书图片</p>
				<div class="layui-upload">
					<button type="button" class="layui-btn layui-btn-primary" id="test2"><i
							class="layui-icon"></i>上传授权书图片</button>
					<div class="layui-upload-list">
						<img class="layui-upload-img" id="demo2">
						<input type="hidden" name="powerOfAttorney" id="powerOfAttorney" value="" lay-verify="required"
							lay-reqtext="请上传授权书图片" />
						<p id="demoText2"></p>
					</div>
				</div>
			</label>
			<button lay-submit="" lay-filter="ApplicationSubmit" type="submit"
				class="layui-btn layui-btn-normal submit">提交</button>
		</form>
	</div>
	<div id="footer"></div>
	<script type="text/javascript" src="../js/jquery-3.4.1.min.js"></script>
	<script type="text/javascript" src="../layui/layui.all.js"></script>
	<script type="text/javascript" src="../js/jquery.qrcode.min.js"></script>
	<script type="text/javascript" src="../js/main.js"></script>
	<script>
		//采购活动
		rchasingActivities();

		layui.use(['laypage', 'layer', 'laytpl'], function () {
			var laypage = layui.laypage,
				laytpl = layui.laytpl,
				layer = layui.layer;

			//获取下载中心左侧类型
			http.ajax({
				url: 'news/news_class_list',
				type: 'GET',
				json: false,
				mask: false,
				data: {
					type: "下载中心"
				}
			}).then(function (data) {
				if (data.code == 200) {
					var data = data.data;
					var getTpl = downloadLeftTpl.innerHTML,
						view = document.getElementById('viewLeft');
					laytpl(getTpl).render(data, function (html) {
						view.innerHTML = html;
					});
					$(".leftTab li:nth-child(1)").addClass("active");
					$(".right h1 b").text(data.items[0].name);
					//下载中心左侧选项卡切换
					$(".leftTab li").click(function () {
						var leftText = $(this).find("p").text();
						$(".crumbs").text(leftText.slice(0, leftText.length - 2));
						$(".right h1 b").text(leftText.slice(0, leftText.length - 2));
						$(this).addClass("active").siblings().removeClass("active");
						var typeId = $(this).find(".id").val();
						get_resource_list_by_type_id(typeId);
					});

					var urltypeId = getQueryString("urltypeId");
					if(urltypeId){
						var leftTab = $(".leftTab li")
						for (var i = 0; i < leftTab.length; i++) {
							if(leftTab.eq(i).find("input").val() == urltypeId){
								leftTab.eq(i).addClass("active").siblings().removeClass("active");
								get_resource_list_by_type_id(urltypeId);
								var leftText = leftTab.eq(i).find("p").text();
								$(".crumbs").text(leftText.slice(0, leftText.length - 2));
								$(".right h1 b").text(leftText.slice(0, leftText.length - 2));
							}
						}	
					}else{
						//通过类型获取右侧列表
						var typeId = data.items[0].id;
						get_resource_list_by_type_id(typeId);
					}
				}
			}, function (err) { });


			//药品列表
			var pageNo = 1;
			var pageSize = 20;
			function get_resource_list_by_type_id(typeId) {
				document.getElementById("viewRight").innerHTML = "";
				layui.use(['laypage', 'layer', 'laytpl'], function () {
					var laypage = layui.laypage,
						laytpl = layui.laytpl,
						layer = layui.layer;
					http.ajax({
						url: 'resource/get_resource_list_by_type_id',
						type: 'GET',
						json: false,
						mask: false,
						data: {
							typeId: typeId,
							pageNo: pageNo,
							pageSize: pageSize
						}
					}).then(function (data) {
						var result = data;
						var totalList = data.data.total;
						$(".total").text(totalList);
						if (data.code == 200) {
							// 数据渲染
							var data = data.data;
							var getTpl = downloadRightTpl.innerHTML,
								view = document.getElementById('viewRight');
							laytpl(getTpl).render(data, function (html) {
								view.innerHTML = html;
							});
							//点击下载
							$(".rightList li .dlBox").click(function () {
								var typeId = $(this).find(".id").val();
								localStorage.setItem("resourceId", typeId)
								download(typeId);
							})
							//分页
							laypage.render({
								elem: 'paging'
								, curr: pageNo
								, limit: pageSize
								, count: totalList
								, layout: ['count', 'prev', 'page', 'next', 'limit', 'skip']
								, jump: function (obj, first) { //触发分页后的回调
									if (!first) { //点击跳页触发函数自身，并传递当前页：obj.curr
										pageNo = obj.curr;
										pageSize = obj.limit;
										get_resource_list_by_type_id(typeId);
									}
								}
							});

						}
					}, function (err) {

					})
				});
			};

		});

		//广告
		advertising();
		function advertising() {
			http.ajax({
				url: 'ad/ad_list',
				type: 'GET',
				json: false,
				mask: false,
				data: {
					type: "下载中心页",//首页','采购信息页','购买标书页','支付成功页','政策信息页','招标信息页','下载中心页
					pageNo: 1,
					pageSize: 5,
				}
			}).then(function (data) {
				if (data.code == 200) {
					var result = data.data.items;
					var iHTML = '';
					for (var i = 0; i < result.length; i++) {
						iHTML += "<div><a title=\"" + result[i].title + "\" target=\"blank\" href=\"" + result[i].url + "\" >" +
							"<img src=\"" + App.filePath + result[i].image.newFilename + "\" />" +
							"</a></div>";
					};
					if (result.length == 0) {
						$(".advertising").hide();
					}
					$("#advertisingListBox").append(iHTML);
					layui.use(['carousel'], function () {
						var carousel = layui.carousel
						//常规轮播
						carousel.render({
							elem: '#advertisingList',
							arrow: 'hover',
							width: '100%',
							height: '205px',
							autoplay: true,
							indicator: 'none',
						});
					})
				}
			}, function (err) {

			});
		};


		// 申请提交
		layui.use('form', function () {
			var form = layui.form
			//监听提交
			form.on('submit(ApplicationSubmit)', function (data) {
				submit_data(data.field)
				$('.submit').addClass("layui-btn-disabled");
				$('.submit').attr('disabled', 'disabled');
				$('.submit').text("提交中...");

				return false;
			});
		});

		layui.use(['form', 'layedit', 'laydate', 'upload'], function () {
			var $ = layui.jquery,
				layer = layui.layer,
				form = layui.form,
				upload = layui.upload;

			//上传营业执照图片
			var uploadInst = upload.render({
				elem: '#test1'
				, url: App.apiBasePath + 'upload/upload_image' //改成您自己的上传接口
				, size: 5120 //限制文件大小，单位 KB
				, accept: 'images'
				, method: 'POST'
				, before: function (obj) {
					//预读本地文件示例，不支持ie8\
					loading = layer.load(); //上传loading
					obj.preview(function (index, file, result) {
						// $('#demo1').attr('src', result); //图片链接（base64）
					});
				}
				, done: function (res) {
					//上传成功
					if (res.code == 200) {
						layer.closeAll('loading'); //关闭loading
						$("#businessLicense").val(res.data);
						$('#demo1').attr('src', App.filePath + res.data); //图片链接（base64）
					} else {
						layer.closeAll('loading'); //关闭loading
						layer.msg('上传失败，请重新上传！');
					}
				}
				, error: function () {
					layer.closeAll('loading'); //关闭loading
					layer.msg('上传失败，请重新上传！');
				}
			});

			//上传授权书图片
			var uploadInst = upload.render({
				elem: '#test2'
				, url: App.apiBasePath + 'upload/upload_image' //改成您自己的上传接口
				, size: 5120 //限制文件大小，单位 KB
				, accept: 'images'
				, method: 'POST'
				, before: function (obj) {
					//预读本地文件示例，不支持ie8\
					loading = layer.load(); //上传loading
					obj.preview(function (index, file, result) {
						// $('#demo1').attr('src', result); //图片链接（base64）
					});
				}
				, done: function (res) {
					//上传成功
					if (res.code == 200) {
						layer.closeAll('loading'); //关闭loading
						$("#powerOfAttorney").val(res.data);
						$('#demo2').attr('src', App.filePath + res.data); //图片链接（base64）
					} else {
						layer.closeAll('loading'); //关闭loading
						layer.msg('上传失败，请重新上传！');
					}
				}
				, error: function () {
					layer.closeAll('loading'); //关闭loading
					layer.msg('上传失败，请重新上传！');
				}
			});

		})

		// 提交申请
		function submit_data(json) {
			json.resourceId = localStorage.getItem("resourceId")
			http.ajax({
				url: 'resource/submit_data',
				type: 'POST',
				json: true,
				mask: true,
				data: JSON.stringify(json)
			}).then(function (data) {
				layer.closeAll(); //疯狂模式，关闭所有层
				$('.submit').removeClass("layui-btn-disabled");
				$('.submit').removeAttr('disabled');
				$('.submit').text("提交");
				if (data.code == 200) {
					layer.msg('申请成功！', {
						icon: 1
					}, function () {
						download(localStorage.getItem("resourceId"));
					});
				} else {
					layer.msg(data.msg, {
						icon: 5
					});
				}

			}, function (err) {

			})
		}

	</script>
</body>

</html>